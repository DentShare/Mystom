# Railway: настройка сервиса веб-админки

Если у вас **два сервиса** из одного репозитория (бот и веб-админка), для сервиса **только админки** проверьте:

## 1. Start Command (иначе ошибка `'$PORT' is not a valid integer`)

В настройках сервиса админки: **Settings** → **Deploy** → **Custom Start Command** (или **Start Command**).

- **Задайте:** `python -m admin_webapp.run_web`
- **Не используйте:** `uvicorn admin_webapp.main:app --host 0.0.0.0 --port $PORT` (переменная `$PORT` не подставляется, контейнер падает).

## 2. Переменная BOT_TOKEN (иначе 401 / «неверная подпись»)

Подпись initData от Telegram проверяется тем же токеном, с которым пользователь открыл Web App.

- В сервисе **веб-админки** в **Variables** должна быть переменная **`BOT_TOKEN`** с **тем же значением**, что и в сервисе **бота**.
- Скопируйте значение из сервиса бота (Variables → BOT_TOKEN) и вставьте в сервис админки. Без лишних пробелов и переносов строк.
- Если переменные общие (project-level), убедитесь, что у сервиса админки нет своего переопределения со старым значением. Лучше задать **BOT_TOKEN** явно в сервисе админки и вставить туда текущий токен бота.
- После изменения Variables сделайте **Redeploy** сервиса админки.

## 3. Остальные переменные

В сервисе админки нужны: **BOT_TOKEN**, **ADMIN_IDS**, **DATABASE_URL** (тот же, что у бота, с `postgresql+asyncpg://`).  
В сервисе **бота** дополнительно задайте **ADMIN_WEBAPP_URL** = URL админки (например `https://ваш-сервис.up.railway.app`).

---

Подробнее: [SETUP.md](SETUP.md) → раздел «Вариант 2: Railway» и «Устранение неполадок».
