# Railway: запуск веб-админки

## Вариант A: Без настройки Start Command в Railway

Оба сервиса (бот и админка) используют **один и тот же** образ и одну команду запуска. Режим задаётся **только переменной** `SERVICE_TYPE`.

### Один сервис (бот + админка вместе)

- Добавьте **один** сервис из репозитория (Dockerfile).
- **Start Command не трогайте** — по умолчанию запускаются миграции, веб-админка в фоне и бот.
- Variables: `BOT_TOKEN`, `ADMIN_IDS`, `DATABASE_URL`, при желании `ADMIN_WEBAPP_URL`.
- **Generate Domain** для этого сервиса — админка будет на том же URL (порт 8080). Скопируйте URL в `ADMIN_WEBAPP_URL` и сделайте Redeploy.

Никакой настройки Start Command, один сервис.

### Два сервиса (бот и админка отдельно)

- **Сервис бота:** Variables как обычно. Start Command **не меняйте** (по умолчанию `python -m app.start` — бот + админка в фоне). Либо задайте переменную `SERVICE_TYPE=bot` для ясности.
- **Сервис только админки:** добавьте второй сервис из того же репо. В **Variables** задайте `SERVICE_TYPE=web` и те же `BOT_TOKEN`, `ADMIN_IDS`, `DATABASE_URL`. **Start Command оставьте пустым** (будет использоваться команда из Dockerfile: `python -m app.start`).
- В сервисе бота в Variables укажите `ADMIN_WEBAPP_URL` = URL второго сервиса (Generate Domain для сервиса админки).

Итого: для веб-админки **ничего не настраивать в разделе Start Command** — только переменная `SERVICE_TYPE=web` и те же Variables, что у бота.

---

## Вариант B: Явный Start Command (как раньше)

Если по какой-то причине не используете `app.start`, для сервиса **только админки** можно задать вручную:

- **Start Command:** `python -m admin_webapp.run_web`  
  (не `uvicorn ... --port $PORT` — иначе ошибка `'$PORT' is not a valid integer`.)
- **Variables:** `BOT_TOKEN`, `ADMIN_IDS`, `DATABASE_URL` — те же значения, что у бота.

---

## 401 / «неверная подпись»

У сервиса веб-админки в Variables переменная **`BOT_TOKEN`** должна **совпадать** с токеном сервиса бота. Скопируйте значение из сервиса бота, вставьте в админку (без пробелов в начале/конце), затем **Redeploy** админки.

---

Подробнее: [SETUP.md](SETUP.md) → «Вариант 2: Railway» и «Устранение неполадок».
