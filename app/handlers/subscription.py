"""–ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏: –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∫–∞—Ä—Ç—É), –≤ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ ‚Äî Uzum Click Pay."""
from aiogram import Router, F
from aiogram.filters import Command
from aiogram.types import Message, CallbackQuery
from aiogram.utils.keyboard import InlineKeyboardBuilder

from app.database.models import User
from app.config import Config

router = Router(name="subscription")

TIER_NAMES = {0: "Basic", 1: "Standard", 2: "Premium"}

# –ü–æ–¥—Ä–æ–±–Ω—ã–π FAQ: —á—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å, –∑–∞ —á—Ç–æ –ø–ª–∞—Ç—è—Ç
FAQ_TEXT = """
üìã **–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ç–∞—Ä–∏—Ñ–æ–≤**

MiniStom –ø–æ–º–æ–≥–∞–µ—Ç –≤–µ—Å—Ç–∏ –ø—Ä–∏—ë–º, –±–∞–∑—É –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –∏ —Ñ–∏–Ω–∞–Ω—Å—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. –ù–∏–∂–µ ‚Äî —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤—Ö–æ–¥–∏—Ç –≤ –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –∏ –∑–∞ —á—Ç–æ –≤—ã –ø–ª–∞—Ç–∏—Ç–µ.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üÜì **BASIC (–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–∞—Ä—Ç)**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–ü–æ–¥—Ö–æ–¥–∏—Ç, —á—Ç–æ–±—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–æ—Ç–∞ –∏ –≤–µ—Å—Ç–∏ –ø—Ä–æ—Å—Ç–æ–π —É—á—ë—Ç –∑–∞–ø–∏—Å–µ–π.

‚Ä¢ **–ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ** ‚Äî –≤—ã–±–æ—Ä –¥–∞—Ç—ã, –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–µ–π –Ω–∞ –¥–µ–Ω—å –∏ –º–µ—Å—è—Ü.
‚Ä¢ **–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º** ‚Äî –≤–≤–æ–¥ –≤—Ä—É—á–Ω—É—é: ¬´–§–ò–û ‚Äî —É—Å–ª—É–≥–∞¬ª, –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏. –£–¥–æ–±–Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞.
‚Ä¢ **–í–∏–∑–∏—Ç–∫–∞ –≤—Ä–∞—á–∞** ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –§–ò–û, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π, —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º, –∞–¥—Ä–µ—Å–æ–º, –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π –∏ —Ñ–æ—Ç–æ. –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç—É –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.
‚Ä¢ **–ü—Ä–∞–π—Å-–ª–∏—Å—Ç** ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ü–µ–Ω (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ Premium).

**–ò—Ç–æ–≥:** –≤—ã –≤–µ–¥—ë—Ç–µ –∑–∞–ø–∏—Å–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ –≤–∏–∑–∏—Ç–∫—É –±–µ–∑ –±–∞–∑—ã –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üü¢ **STANDARD (–°—Ç–∞–Ω–¥–∞—Ä—Ç)**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–î–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –≤ –ø–∞—Ü–∏–µ–Ω—Ç–∞—Ö –∏ –∏—Å—Ç–æ—Ä–∏–∏ –ª–µ—á–µ–Ω–∏—è.

–í—Å—ë –∏–∑ Basic, –ø–ª—é—Å:

‚Ä¢ **–ë–∞–∑–∞ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, –ø–æ–∏—Å–∫ –ø–æ –§–ò–û –∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É, —Å–ø–∏—Å–æ–∫. –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –≤ –±–ª–æ–∫–Ω–æ—Ç–µ.
‚Ä¢ **–ó–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –±–∞–∑—É** ‚Äî –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ –≤—ã–±–∏—Ä–∞–µ—Ç–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∏–∑ –±–∞–∑—ã –∏–ª–∏ —Å–æ–∑–¥–∞—ë—Ç–µ –Ω–æ–≤–æ–≥–æ. –û–¥–∏–Ω —Ä–∞–∑ –≤–≤–µ–ª–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –≤—Å–µ–≥–¥–∞.
‚Ä¢ **–ò—Å—Ç–æ—Ä–∏—è –±–æ–ª–µ–∑–Ω–∏** ‚Äî –∫ –∫–∞–∂–¥–æ–º—É –ø–∞—Ü–∏–µ–Ω—Ç—É: –¥–∞—Ç–∞, —É—Å–ª—É–≥–∞, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π. –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –ø–∞—Ü–∏–µ–Ω—Ç—É –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.
‚Ä¢ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∏ **–ø–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏** –Ω–∞ –¥—Ä—É–≥—É—é –¥–∞—Ç—É/–≤—Ä–µ–º—è –ø—Ä—è–º–æ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.
‚Ä¢ **–ò–º–ø–ª–∞–Ω—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞** ‚Äî —É—á—ë—Ç –∏–º–ø–ª–∞–Ω—Ç–æ–≤ –ø–æ –∑—É–±–∞–º, —Å–∏—Å—Ç–µ–º–∞, —Ä–∞–∑–º–µ—Ä, –¥–∞—Ç–∞. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF-–∫–∞—Ä—Ç—ã** –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∏–ª–∏ –∫–ª–∏–Ω–∏–∫–∏.

**–ò—Ç–æ–≥:** –≤—ã –ø–ª–∞—Ç–∏—Ç–µ –∑–∞ –ø–æ—Ä—è–¥–æ–∫: –±–∞–∑–∞ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤, –∏—Å—Ç–æ—Ä–∏—è –∏ –ø–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–µ–π –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö. –ú–µ–Ω—å—à–µ –ø—É—Ç–∞–Ω–∏—Ü—ã, –±–æ–ª—å—à–µ –¥–æ–≤–µ—Ä–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üîµ **PREMIUM (–ü—Ä–µ–º–∏—É–º)**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–î–ª—è —Ç–µ—Ö, –∫—Ç–æ –≤–µ–¥—ë—Ç —É—á—ë—Ç –¥–µ–Ω–µ–≥ –∏ —Ö–æ—á–µ—Ç –≤—Å—ë –≤ –æ–¥–Ω–æ–º –±–æ—Ç–µ.

–í—Å—ë –∏–∑ Standard, –ø–ª—é—Å:

‚Ä¢ **–§–∏–Ω–∞–Ω—Å—ã** ‚Äî —É—á—ë—Ç –æ–ø–ª–∞—Ç –ø–æ –∫–∞–∂–¥–æ–º—É –ø–∞—Ü–∏–µ–Ω—Ç—É –∏ –ø–æ –∫–∞–∂–¥–æ–π —É—Å–ª—É–≥–µ.
‚Ä¢ **–°–∫–∏–¥–∫–∏** ‚Äî –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—É—é —É—Å–ª—É–≥—É –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é –∏ **—Å–∫–∏–¥–∫–∞ –Ω–∞ –≤—Å—é —Ä–∞–±–æ—Ç—É** –ø—Ä–∏ –≤–Ω–µ—Å–µ–Ω–∏–∏ –æ–ø–ª–∞—Ç—ã.
‚Ä¢ **–í–Ω–µ—Å–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã** ‚Äî –∫–æ–≥–¥–∞ –ø–∞—Ü–∏–µ–Ω—Ç –ø–ª–∞—Ç–∏—Ç: —Å—É–º–º–∞, —Å–ø–æ—Å–æ–± (–Ω–∞–ª–∏—á–Ω—ã–µ/–∫–∞—Ä—Ç–∞/–ø–µ—Ä–µ–≤–æ–¥). –í–∏–¥–Ω–æ, —á—Ç–æ –æ–ø–ª–∞—á–µ–Ω–æ, —á—Ç–æ –≤ –¥–æ–ª–≥–µ.
‚Ä¢ **–ü—Ä–∞–π—Å-–ª–∏—Å—Ç —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º** ‚Äî —Å–≤–æ–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ç–µ—Ä–∞–ø–∏—è, –æ—Ä—Ç–æ–ø–µ–¥–∏—è, —Ö–∏—Ä—É—Ä–≥–∏—è –∏ –¥—Ä.), —Ü–µ–Ω—ã, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏—ë–º–∞.
‚Ä¢ **–°—á–µ—Ç–∞ –≤ PDF** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—á—ë—Ç–∞ –ø–æ –ø–∞—Ü–∏–µ–Ω—Ç—É: —É—Å–ª—É–≥–∏, —Å–∫–∏–¥–∫–∏, –æ–ø–ª–∞—á–µ–Ω–æ, –¥–æ–ª–≥. –£–¥–æ–±–Ω–æ –¥–ª—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏ –∏ –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞.
‚Ä¢ **–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel** ‚Äî –≤—ã–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ —Å–æ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏: –ø–∞—Ü–∏–µ–Ω—Ç—ã, –∑–∞–ø–∏—Å–∏, –∏—Å—Ç–æ—Ä–∏—è –ª–µ—á–µ–Ω–∏—è, –∏–º–ø–ª–∞–Ω—Ç—ã. –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –∏ –æ—Ç—á—ë—Ç—ã –æ–¥–Ω–∏–º —Ñ–∞–π–ª–æ–º.

**–ò—Ç–æ–≥:** –≤—ã –ø–ª–∞—Ç–∏—Ç–µ –∑–∞ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –ø—Ä–∏—ë–º ‚Üí –ø–∞—Ü–∏–µ–Ω—Ç—ã ‚Üí –∏—Å—Ç–æ—Ä–∏—è ‚Üí –¥–µ–Ω—å–≥–∏ ‚Üí —Å—á–µ—Ç–∞ –∏ –≤—ã–≥—Ä—É–∑–∫–∏. –í—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –±–µ–∑ —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã—Ö —Ç–µ—Ç—Ä–∞–¥–µ–π –∏ —Ç–∞–±–ª–∏—Ü.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí° **–ü–æ—á–µ–º—É —É–¥–æ–±–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

‚Ä¢ –í—Å—ë –≤ Telegram ‚Äî –Ω–µ –Ω—É–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞.
‚Ä¢ –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —É –≤–∞—Å (–Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ/–ë–î –ø—Ä–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–º —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏).
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞.

–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –ø–æ–¥ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏ ‚Äî –Ω–∞—á–∞—Ç—å –º–æ–∂–Ω–æ —Å Basic, –∞ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ Standard –∏–ª–∏ Premium –ø–æ –∫–Ω–æ–ø–∫–µ ¬´‚≠ê –ü–æ–¥–ø–∏—Å–∫–∞¬ª.
"""


def _payment_instructions(plan_name: str) -> str:
    """–¢–µ–∫—Å—Ç —Å —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ –æ–ø–ª–∞—Ç–µ."""
    parts = [
        f"üí≥ **–û–ø–ª–∞—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ {plan_name}**",
        "",
        "–°–µ–π—á–∞—Å –ø–æ–¥–ø–∏—Å–∫–∞ –æ—Ñ–æ—Ä–º–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:",
        "",
    ]
    if Config.PAYMENT_CARD:
        parts.append(f"üìå **–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã:** `{Config.PAYMENT_CARD}`")
    if Config.PAYMENT_RECEIVER:
        parts.append(f"üìå **–ü–æ–ª—É—á–∞—Ç–µ–ª—å:** {Config.PAYMENT_RECEIVER}")
    if not Config.PAYMENT_CARD and not Config.PAYMENT_RECEIVER:
        parts.append("–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –≤—ã–¥–∞—ë—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ—Å–ª–µ –∑–∞—è–≤–∫–∏.")
    parts.extend([
        "",
        "**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**",
        "1. –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –∫–∞—Ä—Ç—É (–∏–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã —É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞).",
        "2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —á–µ–∫ –∏–ª–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç –æ–ø–ª–∞—Ç—ã.",
        "3. –ù–∞–ø–∏—à–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ–∫.",
        "4. –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–ª–∞—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –≤—Ä—É—á–Ω—É—é.",
        "",
    ])
    if Config.ADMIN_CONTACT:
        contact = Config.ADMIN_CONTACT.strip()
        if not contact.startswith("http"):
            contact = f"@{contact.lstrip('@')}" if not contact.startswith("@") else contact
        parts.append(f"üë§ **–°–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º:** {contact}")
    else:
        parts.append("üë§ –ö–æ–Ω—Ç–∞–∫—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∑–∞–¥–∞—ë—Ç—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–æ—Ç–∞.")
    parts.extend([
        "",
        "üîú **–°–∫–æ—Ä–æ:** –æ–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π –∏ —á–µ—Ä–µ–∑ **Uzum Click Pay** –ø—Ä—è–º–æ –≤ –±–æ—Ç–µ ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞ –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.",
    ])
    return "\n".join(parts)


@router.message(F.text == "‚≠ê –ü–æ–¥–ø–∏—Å–∫–∞")
async def cmd_subscription(message: Message, user: User):
    """–≠–∫—Ä–∞–Ω –ø–æ–¥–ø–∏—Å–∫–∏: —Ç–µ–∫—É—â–∏–π —Ç–∞—Ä–∏—Ñ –∏ –≤—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏"""
    tier_name = TIER_NAMES.get(user.subscription_tier, "Basic")
    end = ""
    if user.subscription_end_date:
        end = f"\nüìÖ –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: {user.subscription_end_date.strftime('%d.%m.%Y')}"
    elif user.subscription_tier > 0:
        end = "\nüìÖ –°—Ä–æ–∫: –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π"

    text = (
        f"‚≠ê **–ü–æ–¥–ø–∏—Å–∫–∞**\n\n"
        f"–í–∞—à —Ç–µ–∫—É—â–∏–π —Ç–∞—Ä–∏—Ñ: **{tier_name}**{end}\n\n"
        f"**–¢–∞—Ä–∏—Ñ—ã:**\n\n"
        f"üü¢ **Standard** ‚Äî –±–∞–∑–∞ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤, –∏—Å—Ç–æ—Ä–∏—è –±–æ–ª–µ–∑–Ω–∏, –∏–º–ø–ª–∞–Ω—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞, –ø–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–µ–π.\n"
        f"   –°—Ç–æ–∏–º–æ—Å—Ç—å: {Config.SUBSCRIPTION_STANDARD_PRICE}\n\n"
        f"üîµ **Premium** ‚Äî –≤—Å—ë –∏–∑ Standard + —Ñ–∏–Ω–∞–Ω—Å—ã, —É—á—ë—Ç –æ–ø–ª–∞—Ç –∏ —Å–∫–∏–¥–æ–∫, –ø—Ä–∞–π—Å-–ª–∏—Å—Ç, —ç–∫—Å–ø–æ—Ä—Ç –≤ Excel, —Å—á–µ—Ç–∞ PDF.\n"
        f"   –°—Ç–æ–∏–º–æ—Å—Ç—å: {Config.SUBSCRIPTION_PREMIUM_PRICE}\n\n"
        f"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –¥–ª—è –æ–ø–ª–∞—Ç—ã:"
    )
    builder = InlineKeyboardBuilder()
    if user.subscription_tier < 1:
        builder.button(text="üü¢ Standard", callback_data="sub_plan_1")
    if user.subscription_tier < 2:
        builder.button(text="üîµ Premium", callback_data="sub_plan_2")
    if user.subscription_tier >= 2:
        builder.button(text="‚úÖ –£ –≤–∞—Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ç–∞—Ä–∏—Ñ", callback_data="sub_noop")
    builder.button(text="‚ùì –ü–æ–¥—Ä–æ–±–Ω–æ –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö (FAQ)", callback_data="sub_faq")
    builder.adjust(1)
    await message.answer(text, reply_markup=builder.as_markup())


@router.message(Command("faq"))
async def cmd_faq(message: Message):
    """–ö–æ–º–∞–Ω–¥–∞ /faq ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö —Ç–∞—Ä–∏—Ñ–æ–≤"""
    await message.answer(FAQ_TEXT)


@router.callback_query(F.data == "sub_faq")
async def sub_show_faq(callback: CallbackQuery):
    """–ö–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥—Ä–æ–±–Ω–æ –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö¬ª –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø–æ–¥–ø–∏—Å–∫–∏"""
    await callback.message.edit_text(FAQ_TEXT)
    await callback.answer()


@router.callback_query(F.data == "sub_noop")
async def sub_noop(callback: CallbackQuery):
    await callback.answer("–£ –≤–∞—Å —É–∂–µ –ø–æ–¥–∫–ª—é—á—ë–Ω —Ç–∞—Ä–∏—Ñ Premium", show_alert=False)


@router.callback_query(F.data == "sub_plan_1")
async def sub_plan_standard(callback: CallbackQuery, user: User):
    """–í—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ Standard ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –æ–ø–ª–∞—Ç–µ"""
    text = _payment_instructions("Standard")
    await callback.message.edit_text(text)
    await callback.answer()


@router.callback_query(F.data == "sub_plan_2")
async def sub_plan_premium(callback: CallbackQuery, user: User):
    """–í—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ Premium ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –æ–ø–ª–∞—Ç–µ"""
    text = _payment_instructions("Premium")
    await callback.message.edit_text(text)
    await callback.answer()
